services:
  - type: web
    name: ifi-essay-gateway
    env: python
    region: oregon
    plan: starter  # $7/month - upgrade to avoid spin-down. Use 'free' for free tier (spins down after 15min idle)
    buildCommand: pip install -r requirements-flask.txt && mkdir -p artifacts outputs data templates static/css static/js
    startCommand: python flask_app.py
    envVars:
      # Required: Supabase Configuration
      - key: SUPABASE_URL
        sync: false  # Set manually in Render dashboard
      - key: SUPABASE_ANON_KEY
        sync: false  # Set manually in Render dashboard
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false  # Set manually in Render dashboard
      
      # Required: Flask Configuration
      - key: FLASK_SECRET_KEY
        sync: false  # Set manually in Render dashboard (generate with: python -c "import secrets; print(secrets.token_hex(32))")
      - key: FLASK_PORT
        value: $PORT  # Render provides this automatically
      
      # Required: Google Cloud Vision credentials (as JSON string)
      # Set this in Render dashboard: Paste entire service account JSON as a single-line string
      - key: GOOGLE_CLOUD_VISION_CREDENTIALS_JSON
        sync: false  # Set manually in Render dashboard
      
      # Required: Groq API key for LLM extraction
      # Set this in Render dashboard
      - key: GROQ_API_KEY
        sync: false  # Set manually in Render dashboard
      
      # Required: Redis Configuration (for background job queue)
      # Render Key Value (internal): redis://red-XXXXXXXX:6379  (no password, same region)
      # Render Key Value (external): rediss://red-XXXXXXXX:PASSWORD@REGION-kv.render.com:6379
      # Redis Platform / Redis Cloud: redis://default:PASSWORD@HOST:PORT/0
      - key: REDIS_URL
        sync: false  # Set manually in Render dashboard
      
      # Required: Application URL (for email links)
      - key: APP_URL
        sync: false  # Set manually in Render dashboard (e.g., https://your-app.onrender.com)
      
      # Optional: Email Configuration
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false
      - key: SMTP_USE_TLS
        sync: false
      - key: FROM_EMAIL
        sync: false
      
      # Optional: Worker Configuration
      - key: WORKER_ID
        value: worker-1

