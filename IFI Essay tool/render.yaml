services:
  # Web Service - Flask app with embedded background worker
  # No separate worker service needed - saves $7/month!
  - type: web
    name: ifi-essay-gateway
    runtime: python
    region: oregon
    plan: starter
    rootDir: IFI Essay tool
    buildCommand: pip install -r requirements-flask.txt && mkdir -p artifacts outputs data templates static/css static/js
    startCommand: python flask_app.py
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: FLASK_SECRET_KEY
        sync: false
      - key: GOOGLE_CLOUD_VISION_CREDENTIALS_JSON
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: REDIS_URL
        sync: false
      - key: APP_URL
        sync: false
      # Enable embedded background worker (no separate worker service needed)
      - key: EMBEDDED_WORKER
        value: "true"
